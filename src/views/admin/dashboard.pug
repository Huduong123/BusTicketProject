extends ../layouts/layoutAdmin

block head
  link(rel="stylesheet", href="/css/dashboard.css")

block content
  .container.mt-4
    h2.mb-5.text-center.text-primary.fw-bold Báº£ng Ä‘iá»u khiá»ƒn há»‡ thá»‘ng

    // Thá»‘ng kÃª tá»•ng quan
    .row.g-4
      .col-md-3
        .dashboard-card.bg-gradient-primary
          .dashboard-icon ğŸšŒ
          .dashboard-title Tá»•ng chuyáº¿n xe
          .dashboard-value #{totalTrips}
      .col-md-3
        .dashboard-card.bg-gradient-success
          .dashboard-icon ğŸ«
          .dashboard-title VÃ© Ä‘Ã£ bÃ¡n
          .dashboard-value #{ticketsSold}
      .col-md-3
        .dashboard-card.bg-gradient-warning
          .dashboard-icon ğŸ’°
          .dashboard-title Doanh thu thÃ¡ng
          .dashboard-value #{formattedMonthlyRevenue} VNÄ
      .col-md-3
        .dashboard-card.bg-gradient-info
          .dashboard-icon ğŸ—ºï¸
          .dashboard-title Tá»•ng tuyáº¿n xe
          .dashboard-value #{totalRoutes}

    // Biá»ƒu Ä‘á»“ doanh thu
    h4.mt-5.mb-3.text-uppercase.text-secondary.fw-bold Doanh thu 7 ngÃ y gáº§n nháº¥t
    .card.shadow-sm.mb-4
      .card-body
        canvas#revenueChart(style="max-height: 320px")

    // ğŸš Chuyáº¿n sáº¯p khá»Ÿi hÃ nh
    h4.section-title CÃ¡c chuyáº¿n xe sáº¯p khá»Ÿi hÃ nh hÃ´m nay
    .table-section
      table.table.table-hover
        thead
          tr
            th MÃ£ chuyáº¿n
            th Tuyáº¿n Ä‘Æ°á»ng
            th Giá» khá»Ÿi hÃ nh
            th Tráº¡ng thÃ¡i
        tbody
          each trip in upcomingTrips
            tr
              td.fw-bold= trip.code
              td= trip.route
              td= trip.time
              td 
                if trip.status == 'ON_TIME'
                  span.badge.bg-success.d-inline-flex.align-items-center
                    i.bi.bi-check-circle-fill
                    | ON TIME
                else if trip.status == 'CANCELED'
                  span.badge.bg-danger.d-inline-flex.align-items-center
                    i.bi.bi-x-circle-fill
                    | CANCELED
                else if trip.status == 'DELAYED'
                  span.badge.bg-warning.text-dark.d-inline-flex.align-items-center
                    i.bi.bi-clock-history
                    | DELAYED
                else
                  span.badge.bg-secondary= trip.status

    // ğŸ§¾ VÃ© má»›i Ä‘áº·t
    h4.section-title VÃ© Ä‘áº·t gáº§n Ä‘Ã¢y
    .table-section
      table.table.table-hover
        thead
          tr
            th MÃ£ vÃ©
            th TÃªn khÃ¡ch
            th Tuyáº¿n
            th GiÃ¡
            th Thá»i gian Ä‘áº·t
        tbody
          each ticket in recentTickets
            tr
              td.fw-medium.text-primary= ticket.code
              td= ticket.name
              td= ticket.route
              td.text-success= ticket.price.toLocaleString() + ' VNÄ'
              td.text-muted= ticket.time


  // Script biá»ƒu Ä‘á»“
  script(src="https://cdn.jsdelivr.net/npm/chart.js")
  script.
    const ctx = document.getElementById('revenueChart').getContext('2d');
    const revenueChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: !{JSON.stringify(revenueChart.labels)},
        datasets: [{
          label: 'Doanh thu (VNÄ)',
          data: !{JSON.stringify(revenueChart.values)},
          borderColor: '#ff7f50',
          backgroundColor: 'rgba(255, 127, 80, 0.3)',
          tension: 0.3,
          fill: true,
          pointBackgroundColor: '#dc3545'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            display: true,
            position: 'top'
          }
        },
        scales: {
          y: {
            ticks: {
              callback: function(value) {
                return value.toLocaleString() + ' â‚«';
              }
            }
          }
        }
      }
    });
