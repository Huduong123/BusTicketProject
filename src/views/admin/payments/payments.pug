extends ../../layouts/layoutAdmin

block content
  .container.mt-4
    h2.text-center.mb-4 Qu·∫£n l√Ω Thanh to√°n

    // üîç Form t√¨m ki·∫øm n√¢ng cao
    form(action="/admins/payments/search" method="GET" class="row g-3 mb-4")
      .col-md-3
        label.form-label(for="transaction_id") M√£ giao d·ªãch
        input.form-control(type="text" name="transaction_id" id="transaction_id" value=(transaction_id || ''))

      .col-md-3
        label.form-label(for="user_name") T√™n ng∆∞·ªùi d√πng
        input.form-control(type="text" name="user_name" id="user_name" value=(user_name || ''))

      .col-md-3
        label.form-label(for="customer_name") T√™n kh√°ch
        input.form-control(type="text" name="customer_name" id="customer_name" value=(customer_name || ''))

      .col-md-3
        label.form-label(for="customer_phone") SƒêT kh√°ch
        input.form-control(type="text" name="customer_phone" id="customer_phone" value=(customer_phone || ''))

      .col-md-3
        label.form-label(for="payment_method") Ph∆∞∆°ng th·ª©c
        select.form-select(name="payment_method" id="payment_method")
          option(value="") -- Ch·ªçn ph∆∞∆°ng th·ª©c --
          option(value="ZaloPay") ZaloPay
          option(value="MOMO") MOMO
          option(value="ViettelMoney") ViettelMoney
          option(value="VNPAY") VNPAY
          option(value="ShopeePay") ShopeePay
          option(value="VietQR") VietQR
      .col-md-3
        label.form-label(for="payment_status") Tr·∫°ng th√°i
        select.form-select(name="payment_status" id="payment_status")
          option(value="") -- Ch·ªçn tr·∫°ng th√°i --
          option(value="COMPLETED") Ho√†n t·∫•t
          option(value="PENDING") Ch·ªù x·ª≠ l√Ω
          option(value="FAILED") Th·∫•t b·∫°i
          option(value="CANCELED") ƒê√£ h·ªßy

      .col-md-3
        label.form-label(for="payment_date") Ng√†y thanh to√°n
        input.form-control(type="date" name="payment_date" id="payment_date" value=(payment_date || ''))

      .col-12.text-center
        button.btn.btn-primary(type="submit") T√¨m ki·∫øm
        a.btn.btn-secondary(href="/admins/payments") Reset

    .table-responsive
      table.table.table-bordered.table-hover
        thead.table-dark
          tr
            th STT
            th M√£ giao d·ªãch
            th Ng∆∞·ªùi d√πng
            th T√™n kh√°ch
            th SƒêT kh√°ch
            th Ph∆∞∆°ng th·ª©c
            th T·ªïng ti·ªÅn
            th Tr·∫°ng th√°i
            th Ng√†y thanh to√°n
            th Ng√†y c·∫≠p nh·∫≠t
            th H√†nh ƒë·ªông
        tbody
          if payments && payments.length
            each p, index in payments
              tr
                td= index + 1
                td= p.transaction_id
                td= p.user_name || '-'
                td= p.customer_name || '-'
                td= p.customer_phone || '-'
                td= p.payment_method || '-'
                td= p.amount.toLocaleString('vi-VN') + ' ƒë'
                td
                  if p.payment_status === 'COMPLETED'
                    span.text-success Ho√†n t·∫•t
                  else if p.payment_status === 'PENDING'
                    span.text-warning Ch·ªù x·ª≠ l√Ω
                  else if p.payment_status === 'CANCELED'
                    span.text-secondary ƒê√£ h·ªßy
                  else
                    span.text-danger Th·∫•t b·∫°i
                td= new Date(p.payment_date).toLocaleString('vi-VN')
                td= new Date(p.updated_at).toLocaleString('vi-VN')
                td
                  .d-flex.gap-2
                    if p.payment_status !== 'COMPLETED'
                      form(action=`/admins/payments/cancel/${p.id}`, method="POST", class="d-inline")
                        button.btn.btn-outline-warning.btn-sm(type="submit" onclick="return confirm('X√°c nh·∫≠n h·ªßy thanh to√°n n√†y?')") H·ªßy

                      form(action=`/admins/payments/delete/${p.id}`, method="POST", class="d-inline")
                        button.btn.btn-outline-danger.btn-sm(type="submit" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a thanh to√°n n√†y?')") X√≥a
                    else
                      span.text-muted Kh√¥ng kh·∫£ d·ª•ng
          else
            tr
              td.text-center(colspan="11") Kh√¥ng c√≥ d·ªØ li·ªáu thanh to√°n.
